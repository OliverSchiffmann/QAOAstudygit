Bootstrap: docker
From: python:3.10

# ==============================================================================
# Apptainer/Singularity Definition File for ALICEBOB QAOA Simulation
# ==============================================================================
# This file defines how the ALICEBOBSim.silf container image is built and executed.
# This container is used by the SLURM submission script (qaoa_knapsack_slurm.sh)
# to ensure a reproducible environment for the Knapsack problem benchmarking.
#
# Base Image: Python 3.10 is used as the foundational operating system and language environment.
# Execution: The container installs dependencies and runs the main Python script
#            using parameters passed via SLURM environment variables (PROBLEM_TYPE, etc.).
# ==============================================================================

%files
    # Copy local scripts into the root directory of the container
    QAOA_ALICEBOB_Sim.py /
    helpers.py /
    config.py /
    aliceBobRequirements.txt /

%runscript
# Docstring:
# Defines the default command executed when the container runs.
# 1. Installs all required Python dependencies specified in the requirements file.
# 2. Executes the main QAOA simulation script (QAOA_ALICEBOB_Sim.py).
# 3. Critical parameters are passed via container environment variables, which
#    are set by the calling SLURM job array script (e.g., qaoa_knapsack_slurm.sh).
    pip install -r /aliceBobRequirements.txt
    python /QAOA_ALICEBOB_Sim.py \
        --problem_type $PROBLEM_TYPE \
        --instance_id $INSTANCE_ID \
        --num_layers $NUM_LAYERS